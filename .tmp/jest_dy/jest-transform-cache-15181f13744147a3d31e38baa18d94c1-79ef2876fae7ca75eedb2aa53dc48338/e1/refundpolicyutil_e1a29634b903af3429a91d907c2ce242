197a2b60a0234d4ed3acb6958f118171
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.REFUND_PROCESSING_FEE_PKR = exports.REFUND_POLICY_LINK = void 0;
exports.computeRefundQuote = computeRefundQuote;
const dayjs = require("dayjs");
const utc = require("dayjs/plugin/utc");
const timezone = require("dayjs/plugin/timezone");
const wallet_constants_1 = require("src/wallet/wallet.constants");
dayjs.extend(utc);
dayjs.extend(timezone);
exports.REFUND_POLICY_LINK = 'https://3musafir.com/refundpolicyby3musafir';
exports.REFUND_PROCESSING_FEE_PKR = 500;
function computeRefundQuote(params) {
    const amountPaid = Math.max(0, Math.floor(Number(params.amountPaid) || 0));
    const submittedAt = params.submittedAt ? new Date(params.submittedAt) : new Date();
    const flagshipStartDate = new Date(params.flagshipStartDate);
    const startDay = dayjs(flagshipStartDate).tz(wallet_constants_1.PK_TIMEZONE).startOf('day');
    const submittedDay = dayjs(submittedAt).tz(wallet_constants_1.PK_TIMEZONE).startOf('day');
    const daysBeforeDeparture = startDay.diff(submittedDay, 'day');
    let refundPercent = 0;
    let tierLabel = '0-4 days';
    if (daysBeforeDeparture >= 15) {
        refundPercent = 100;
        tierLabel = '15+ days';
    }
    else if (daysBeforeDeparture >= 10) {
        refundPercent = 50;
        tierLabel = '10-14 days';
    }
    else if (daysBeforeDeparture >= 5) {
        refundPercent = 30;
        tierLabel = '5-9 days';
    }
    else {
        refundPercent = 0;
        tierLabel = '0-4 days';
    }
    const gross = Math.floor((amountPaid * refundPercent) / 100);
    const refundAmount = Math.max(0, gross - exports.REFUND_PROCESSING_FEE_PKR);
    return {
        amountPaid,
        daysBeforeDeparture,
        refundPercent,
        processingFee: exports.REFUND_PROCESSING_FEE_PKR,
        tierLabel,
        refundAmount,
        policyLink: exports.REFUND_POLICY_LINK,
        policyAppliedAt: new Date(),
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2RldnByb2ZpbGUvRG9jdW1lbnRzL0dpdEh1Yi9tdXNhZmlyX2JhY2tlbmQvc3JjL3BheW1lbnQvcmVmdW5kLXBvbGljeS51dGlsLnRzIiwibWFwcGluZ3MiOiI7OztBQWlCQSxnREEyQ0M7QUE1REQsK0JBQWdDO0FBQ2hDLHdDQUF5QztBQUN6QyxrREFBbUQ7QUFDbkQsa0VBQTBEO0FBRTFELEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDbEIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUVWLFFBQUEsa0JBQWtCLEdBQUcsNkNBQXNELENBQUM7QUFDNUUsUUFBQSx5QkFBeUIsR0FBRyxHQUFZLENBQUM7QUFRdEQsU0FBZ0Isa0JBQWtCLENBQUMsTUFJbEM7SUFDQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzRSxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7SUFDbkYsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUU3RCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUFFLENBQUMsOEJBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN6RSxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLDhCQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkUsTUFBTSxtQkFBbUIsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUUvRCxJQUFJLGFBQWEsR0FBRyxDQUFDLENBQUM7SUFDdEIsSUFBSSxTQUFTLEdBQW9CLFVBQVUsQ0FBQztJQUU1QyxJQUFJLG1CQUFtQixJQUFJLEVBQUUsRUFBRSxDQUFDO1FBQzlCLGFBQWEsR0FBRyxHQUFHLENBQUM7UUFDcEIsU0FBUyxHQUFHLFVBQVUsQ0FBQztJQUN6QixDQUFDO1NBQU0sSUFBSSxtQkFBbUIsSUFBSSxFQUFFLEVBQUUsQ0FBQztRQUNyQyxhQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ25CLFNBQVMsR0FBRyxZQUFZLENBQUM7SUFDM0IsQ0FBQztTQUFNLElBQUksbUJBQW1CLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDcEMsYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixTQUFTLEdBQUcsVUFBVSxDQUFDO0lBQ3pCLENBQUM7U0FBTSxDQUFDO1FBQ04sYUFBYSxHQUFHLENBQUMsQ0FBQztRQUNsQixTQUFTLEdBQUcsVUFBVSxDQUFDO0lBQ3pCLENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsVUFBVSxHQUFHLGFBQWEsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQzdELE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEtBQUssR0FBRyxpQ0FBeUIsQ0FBQyxDQUFDO0lBRXBFLE9BQU87UUFDTCxVQUFVO1FBQ1YsbUJBQW1CO1FBQ25CLGFBQWE7UUFDYixhQUFhLEVBQUUsaUNBQXlCO1FBQ3hDLFNBQVM7UUFDVCxZQUFZO1FBQ1osVUFBVSxFQUFFLDBCQUFrQjtRQUM5QixlQUFlLEVBQUUsSUFBSSxJQUFJLEVBQUU7S0FDNUIsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2RldnByb2ZpbGUvRG9jdW1lbnRzL0dpdEh1Yi9tdXNhZmlyX2JhY2tlbmQvc3JjL3BheW1lbnQvcmVmdW5kLXBvbGljeS51dGlsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkYXlqcyA9IHJlcXVpcmUoJ2RheWpzJyk7XG5pbXBvcnQgdXRjID0gcmVxdWlyZSgnZGF5anMvcGx1Z2luL3V0YycpO1xuaW1wb3J0IHRpbWV6b25lID0gcmVxdWlyZSgnZGF5anMvcGx1Z2luL3RpbWV6b25lJyk7XG5pbXBvcnQgeyBQS19USU1FWk9ORSB9IGZyb20gJ3NyYy93YWxsZXQvd2FsbGV0LmNvbnN0YW50cyc7XG5cbmRheWpzLmV4dGVuZCh1dGMpO1xuZGF5anMuZXh0ZW5kKHRpbWV6b25lKTtcblxuZXhwb3J0IGNvbnN0IFJFRlVORF9QT0xJQ1lfTElOSyA9ICdodHRwczovLzNtdXNhZmlyLmNvbS9yZWZ1bmRwb2xpY3lieTNtdXNhZmlyJyBhcyBjb25zdDtcbmV4cG9ydCBjb25zdCBSRUZVTkRfUFJPQ0VTU0lOR19GRUVfUEtSID0gNTAwIGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBSZWZ1bmRUaWVyTGFiZWwgPVxuICB8ICcxNSsgZGF5cydcbiAgfCAnMTAtMTQgZGF5cydcbiAgfCAnNS05IGRheXMnXG4gIHwgJzAtNCBkYXlzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXB1dGVSZWZ1bmRRdW90ZShwYXJhbXM6IHtcbiAgZmxhZ3NoaXBTdGFydERhdGU6IERhdGU7XG4gIHN1Ym1pdHRlZEF0OiBEYXRlO1xuICBhbW91bnRQYWlkOiBudW1iZXI7XG59KSB7XG4gIGNvbnN0IGFtb3VudFBhaWQgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKE51bWJlcihwYXJhbXMuYW1vdW50UGFpZCkgfHwgMCkpO1xuICBjb25zdCBzdWJtaXR0ZWRBdCA9IHBhcmFtcy5zdWJtaXR0ZWRBdCA/IG5ldyBEYXRlKHBhcmFtcy5zdWJtaXR0ZWRBdCkgOiBuZXcgRGF0ZSgpO1xuICBjb25zdCBmbGFnc2hpcFN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHBhcmFtcy5mbGFnc2hpcFN0YXJ0RGF0ZSk7XG5cbiAgY29uc3Qgc3RhcnREYXkgPSBkYXlqcyhmbGFnc2hpcFN0YXJ0RGF0ZSkudHooUEtfVElNRVpPTkUpLnN0YXJ0T2YoJ2RheScpO1xuICBjb25zdCBzdWJtaXR0ZWREYXkgPSBkYXlqcyhzdWJtaXR0ZWRBdCkudHooUEtfVElNRVpPTkUpLnN0YXJ0T2YoJ2RheScpO1xuICBjb25zdCBkYXlzQmVmb3JlRGVwYXJ0dXJlID0gc3RhcnREYXkuZGlmZihzdWJtaXR0ZWREYXksICdkYXknKTtcblxuICBsZXQgcmVmdW5kUGVyY2VudCA9IDA7XG4gIGxldCB0aWVyTGFiZWw6IFJlZnVuZFRpZXJMYWJlbCA9ICcwLTQgZGF5cyc7XG5cbiAgaWYgKGRheXNCZWZvcmVEZXBhcnR1cmUgPj0gMTUpIHtcbiAgICByZWZ1bmRQZXJjZW50ID0gMTAwO1xuICAgIHRpZXJMYWJlbCA9ICcxNSsgZGF5cyc7XG4gIH0gZWxzZSBpZiAoZGF5c0JlZm9yZURlcGFydHVyZSA+PSAxMCkge1xuICAgIHJlZnVuZFBlcmNlbnQgPSA1MDtcbiAgICB0aWVyTGFiZWwgPSAnMTAtMTQgZGF5cyc7XG4gIH0gZWxzZSBpZiAoZGF5c0JlZm9yZURlcGFydHVyZSA+PSA1KSB7XG4gICAgcmVmdW5kUGVyY2VudCA9IDMwO1xuICAgIHRpZXJMYWJlbCA9ICc1LTkgZGF5cyc7XG4gIH0gZWxzZSB7XG4gICAgcmVmdW5kUGVyY2VudCA9IDA7XG4gICAgdGllckxhYmVsID0gJzAtNCBkYXlzJztcbiAgfVxuXG4gIGNvbnN0IGdyb3NzID0gTWF0aC5mbG9vcigoYW1vdW50UGFpZCAqIHJlZnVuZFBlcmNlbnQpIC8gMTAwKTtcbiAgY29uc3QgcmVmdW5kQW1vdW50ID0gTWF0aC5tYXgoMCwgZ3Jvc3MgLSBSRUZVTkRfUFJPQ0VTU0lOR19GRUVfUEtSKTtcblxuICByZXR1cm4ge1xuICAgIGFtb3VudFBhaWQsXG4gICAgZGF5c0JlZm9yZURlcGFydHVyZSxcbiAgICByZWZ1bmRQZXJjZW50LFxuICAgIHByb2Nlc3NpbmdGZWU6IFJFRlVORF9QUk9DRVNTSU5HX0ZFRV9QS1IsXG4gICAgdGllckxhYmVsLFxuICAgIHJlZnVuZEFtb3VudCxcbiAgICBwb2xpY3lMaW5rOiBSRUZVTkRfUE9MSUNZX0xJTkssXG4gICAgcG9saWN5QXBwbGllZEF0OiBuZXcgRGF0ZSgpLFxuICB9O1xufVxuXG4iXSwidmVyc2lvbiI6M30=