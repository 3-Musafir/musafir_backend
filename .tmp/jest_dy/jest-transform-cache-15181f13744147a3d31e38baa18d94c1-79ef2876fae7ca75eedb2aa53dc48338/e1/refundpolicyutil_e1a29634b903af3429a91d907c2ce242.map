{"file":"/Users/devprofile/Documents/GitHub/musafir_backend/src/payment/refund-policy.util.ts","mappings":";;;AAiBA,gDA2CC;AA5DD,+BAAgC;AAChC,wCAAyC;AACzC,kDAAmD;AACnD,kEAA0D;AAE1D,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAClB,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;AAEV,QAAA,kBAAkB,GAAG,6CAAsD,CAAC;AAC5E,QAAA,yBAAyB,GAAG,GAAY,CAAC;AAQtD,SAAgB,kBAAkB,CAAC,MAIlC;IACC,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAC3E,MAAM,WAAW,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE,CAAC;IACnF,MAAM,iBAAiB,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC;IAE7D,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,CAAC,EAAE,CAAC,8BAAW,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACzE,MAAM,YAAY,GAAG,KAAK,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,8BAAW,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACvE,MAAM,mBAAmB,GAAG,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;IAE/D,IAAI,aAAa,GAAG,CAAC,CAAC;IACtB,IAAI,SAAS,GAAoB,UAAU,CAAC;IAE5C,IAAI,mBAAmB,IAAI,EAAE,EAAE,CAAC;QAC9B,aAAa,GAAG,GAAG,CAAC;QACpB,SAAS,GAAG,UAAU,CAAC;IACzB,CAAC;SAAM,IAAI,mBAAmB,IAAI,EAAE,EAAE,CAAC;QACrC,aAAa,GAAG,EAAE,CAAC;QACnB,SAAS,GAAG,YAAY,CAAC;IAC3B,CAAC;SAAM,IAAI,mBAAmB,IAAI,CAAC,EAAE,CAAC;QACpC,aAAa,GAAG,EAAE,CAAC;QACnB,SAAS,GAAG,UAAU,CAAC;IACzB,CAAC;SAAM,CAAC;QACN,aAAa,GAAG,CAAC,CAAC;QAClB,SAAS,GAAG,UAAU,CAAC;IACzB,CAAC;IAED,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,UAAU,GAAG,aAAa,CAAC,GAAG,GAAG,CAAC,CAAC;IAC7D,MAAM,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,GAAG,iCAAyB,CAAC,CAAC;IAEpE,OAAO;QACL,UAAU;QACV,mBAAmB;QACnB,aAAa;QACb,aAAa,EAAE,iCAAyB;QACxC,SAAS;QACT,YAAY;QACZ,UAAU,EAAE,0BAAkB;QAC9B,eAAe,EAAE,IAAI,IAAI,EAAE;KAC5B,CAAC;AACJ,CAAC","names":[],"sources":["/Users/devprofile/Documents/GitHub/musafir_backend/src/payment/refund-policy.util.ts"],"sourcesContent":["import dayjs = require('dayjs');\nimport utc = require('dayjs/plugin/utc');\nimport timezone = require('dayjs/plugin/timezone');\nimport { PK_TIMEZONE } from 'src/wallet/wallet.constants';\n\ndayjs.extend(utc);\ndayjs.extend(timezone);\n\nexport const REFUND_POLICY_LINK = 'https://3musafir.com/refundpolicyby3musafir' as const;\nexport const REFUND_PROCESSING_FEE_PKR = 500 as const;\n\nexport type RefundTierLabel =\n  | '15+ days'\n  | '10-14 days'\n  | '5-9 days'\n  | '0-4 days';\n\nexport function computeRefundQuote(params: {\n  flagshipStartDate: Date;\n  submittedAt: Date;\n  amountPaid: number;\n}) {\n  const amountPaid = Math.max(0, Math.floor(Number(params.amountPaid) || 0));\n  const submittedAt = params.submittedAt ? new Date(params.submittedAt) : new Date();\n  const flagshipStartDate = new Date(params.flagshipStartDate);\n\n  const startDay = dayjs(flagshipStartDate).tz(PK_TIMEZONE).startOf('day');\n  const submittedDay = dayjs(submittedAt).tz(PK_TIMEZONE).startOf('day');\n  const daysBeforeDeparture = startDay.diff(submittedDay, 'day');\n\n  let refundPercent = 0;\n  let tierLabel: RefundTierLabel = '0-4 days';\n\n  if (daysBeforeDeparture >= 15) {\n    refundPercent = 100;\n    tierLabel = '15+ days';\n  } else if (daysBeforeDeparture >= 10) {\n    refundPercent = 50;\n    tierLabel = '10-14 days';\n  } else if (daysBeforeDeparture >= 5) {\n    refundPercent = 30;\n    tierLabel = '5-9 days';\n  } else {\n    refundPercent = 0;\n    tierLabel = '0-4 days';\n  }\n\n  const gross = Math.floor((amountPaid * refundPercent) / 100);\n  const refundAmount = Math.max(0, gross - REFUND_PROCESSING_FEE_PKR);\n\n  return {\n    amountPaid,\n    daysBeforeDeparture,\n    refundPercent,\n    processingFee: REFUND_PROCESSING_FEE_PKR,\n    tierLabel,\n    refundAmount,\n    policyLink: REFUND_POLICY_LINK,\n    policyAppliedAt: new Date(),\n  };\n}\n\n"],"version":3}