{"file":"/Users/devprofile/Documents/GitHub/musafir_backend/src/storage/storageService.ts","mappings":"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","names":[],"sources":["/Users/devprofile/Documents/GitHub/musafir_backend/src/storage/storageService.ts"],"sourcesContent":["import {\n  S3Client,\n  PutObjectCommand,\n  DeleteObjectCommand,\n  GetObjectCommand,\n} from '@aws-sdk/client-s3';\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\nimport { Injectable } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { Readable } from 'stream';\n\n@Injectable()\nexport class StorageService {\n  private s3: S3Client;\n  private bucket: string;\n\n  constructor(private configService: ConfigService) {\n    const region = this.configService.get<string>('AWS_REGION');\n    const accessKeyId = this.configService.get<string>('AWS_ACCESS_KEY_ID');\n    const bucketName = this.configService.get<string>('AWS_BUCKET_NAME');\n    \n\n    this.s3 = new S3Client({\n      region: region,\n      credentials: {\n        accessKeyId: accessKeyId,\n        secretAccessKey: this.configService.get<string>(\n          'AWS_SECRET_ACCESS_KEY',\n        ),\n      },\n    });\n\n    this.bucket = bucketName;\n  }\n\n  async uploadFile(\n    key: string,\n    buffer: Buffer,\n    mimetype: string,\n  ): Promise<string> {\n\n    try {\n      const command = new PutObjectCommand({\n        Bucket: this.bucket,\n        Key: key,\n        Body: buffer,\n        ContentType: mimetype,\n      });\n\n      const response = await this.s3.send(command);\n\n      return key;\n    } catch (error: any) {\n      throw new Error(`S3 Upload failed for ${key}: ${error.message}`);\n    }\n  }\n\n  async deleteFile(key: string): Promise<void> {\n    await this.s3.send(\n      new DeleteObjectCommand({\n        Bucket: this.bucket,\n        Key: key,\n      }),\n    );\n  }\n\n  async getSignedUrl(key: string, expiresIn = 3600): Promise<string> {\n    const command = new GetObjectCommand({\n      Bucket: this.bucket,\n      Key: key,\n    });\n\n    return getSignedUrl(this.s3, command, { expiresIn });\n  }\n\n  async getImageData(key: string): Promise<string> {\n    const command = new GetObjectCommand({\n      Bucket: this.bucket,\n      Key: key,\n    });\n\n    const response = await this.s3.send(command);\n    const stream = response.Body as Readable;\n\n    const chunks: Buffer[] = [];\n    for await (const chunk of stream) {\n      chunks.push(Buffer.from(chunk));\n    }\n    const buffer = Buffer.concat(chunks);\n\n    const base64 = buffer.toString('base64');\n    const contentType = response.ContentType || 'image/jpeg';\n\n    return `data:${contentType};base64,${base64}`;\n  }\n}\n"],"version":3}