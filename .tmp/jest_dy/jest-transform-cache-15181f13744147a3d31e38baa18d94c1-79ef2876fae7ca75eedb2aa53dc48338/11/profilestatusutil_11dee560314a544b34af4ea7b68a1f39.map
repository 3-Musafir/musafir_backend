{"file":"/Users/devprofile/Documents/GitHub/musafir_backend/src/user/profile-status.util.ts","mappings":"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","names":[],"sources":["/Users/devprofile/Documents/GitHub/musafir_backend/src/user/profile-status.util.ts"],"sourcesContent":["import { User } from './interfaces/user.interface';\n\nexport type ProfileFieldKey =\n  | 'phone'\n  | 'cnic'\n  | 'city'\n  | 'socialLink'\n  | 'employmentStatus'\n  | 'university'\n  | 'gender';\n\nexport interface ProfileStatus {\n  complete: boolean;\n  missing: ProfileFieldKey[];\n  requiredFor: {\n    general: ProfileFieldKey[];\n    flagshipRegistration: ProfileFieldKey[];\n    verification: ProfileFieldKey[];\n  };\n}\n\nexport const PROFILE_FIELD_LABELS: Record<ProfileFieldKey, string> = {\n  phone: 'Phone number',\n  cnic: 'CNIC',\n  city: 'City',\n  socialLink: 'Social link',\n  employmentStatus: 'Employment status',\n  university: 'University/organization',\n  gender: 'Gender',\n};\n\nconst digits = (value?: string) =>\n  typeof value === 'string' ? value.replace(/\\D/g, '') : '';\n\nconst normalizeEmploymentStatus = (user: Partial<User>) =>\n  (user as any)?.employmentStatus || 'unemployed';\n\nexport function buildProfileStatus(user: Partial<User>): ProfileStatus {\n  const employmentStatus = normalizeEmploymentStatus(user);\n  const requiresWorkDetail = employmentStatus !== 'unemployed';\n\n  const checkField = {\n    phone: () => digits(user.phone || '').length >= 10,\n    cnic: () => typeof user.cnic === 'string' && user.cnic.trim().length === 13,\n    city: () => Boolean(user.city),\n    socialLink: () => Boolean(user.socialLink),\n    employmentStatus: () =>\n      ['student', 'employed', 'selfEmployed', 'unemployed'].includes(\n        employmentStatus as string,\n      ),\n    university: () => (requiresWorkDetail ? Boolean(user.university) : true),\n    gender: () => Boolean(user.gender),\n  };\n\n  const generalFields: ProfileFieldKey[] = [\n    'phone',\n    'cnic',\n    'city',\n    'socialLink',\n    'employmentStatus',\n    'university',\n    'gender',\n  ];\n\n  const flagshipFields: ProfileFieldKey[] = [\n    'phone',\n    'cnic',\n    'city',\n    'employmentStatus',\n    'university',\n    'gender',\n  ];\n\n  const verificationFields: ProfileFieldKey[] = [\n    'phone',\n    'gender',\n    'socialLink',\n  ];\n\n  const missingFor = (fields: ProfileFieldKey[]) =>\n    fields.filter((field) => !checkField[field]());\n\n  const missing = missingFor(generalFields);\n  const flagshipMissing = missingFor(flagshipFields);\n  const verificationMissing = missingFor(verificationFields);\n\n  return {\n    complete: missing.length === 0,\n    missing,\n    requiredFor: {\n      general: missing,\n      flagshipRegistration: flagshipMissing,\n      verification: verificationMissing,\n    },\n  };\n}\n\nexport function isProfileComplete(user: Partial<User>): boolean {\n  return buildProfileStatus(user).complete;\n}\n\nexport function describeMissingProfileFields(fields: ProfileFieldKey[]): string[] {\n  return (fields || []).map((field) => PROFILE_FIELD_LABELS[field] || field);\n}\n"],"version":3}